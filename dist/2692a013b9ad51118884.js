import"./style.css";import{storageAvailable,projectsOnLoad}from"./storage.js";import{projectDB}from"./projects.js";import radialBtnsMenu from"./radialButtons.js";import leftDOM from"./left_panel.js";import rightDOM from"./right_panel.js";import addListeners from"./listeners.js";const containerLHS=document.querySelector(".container-left");let projectList=projectsOnLoad();const leftPanelContent=leftDOM.onloadLeft(projectList);function callback_showProjectDetails(e){const t=document.querySelector(".container-right");deleteChildNodes(t);let r=get_selectedProject(e.target.innerText)[0];const a=rightDOM.mainTitleRight(r),s=rightDOM.projectDescriptionLabel(),i=rightDOM.displayDescription(r),n=rightDOM.taskMgeBtn();t.append(a,s,i,n),addListeners.listenerEditProjectDescription(r),addListeners.listenerManageTasks()}function callback_deleteProject(e){const t=document.querySelector(".container-right"),r=document.querySelector(".container-left");deleteChildNodes(t),deleteChildNodes(r);let a=e.target.previousSibling.firstChild.data,s=0;for(const e of projectList)e.name==a&&projectList.splice(s,1),s+=1;storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)),leftDOM.onloadLeft(projectList),addListeners.listenerDatabase(),addListeners.listenerDeleteProject(),addListeners.listenerShowProjectDescription()}function callback_addProject(){const e=document.querySelector(".container-right"),t=document.querySelector(".container-left");deleteChildNodes(e),deleteChildNodes(t),leftDOM.addProjectLoad(projectList),addListeners.listenerAddProject(),addListeners.listenerInputAddProject()}function callback_inputAddProject(e){if("Enter"===e.key){const e=document.querySelector(".input-box-add-project");let t=projectDB();t.name=e.value,t.describe="",projectList.push(t),storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)),deleteChildNodes(document.querySelector(".container-left")),leftDOM.onloadLeft(projectList),addListeners.listenerDatabase(),addListeners.listenerDeleteProject(),addListeners.listenerShowProjectDescription(),addListeners.listenerAddProject()}}function callback_resetDatabase(){const e=document.querySelector(".container-right"),t=document.querySelector(".container-left");deleteChildNodes(e),deleteChildNodes(t),_resetDatabase(),projectList=projectsOnLoad(),leftDOM.onloadLeft(projectList),addListeners.listenerDatabase(),addListeners.listenerDeleteProject(),addListeners.listenerShowProjectDescription()}function callback_editProjectDescription(){const e=document.querySelector(".container-right");document.querySelector(".container-left");let t=get_selectedProject(document.querySelector(".title-panel-right").innerHTML)[0];const r=rightDOM.mainTitleRight(t),a=rightDOM.projectDescriptionLabel(),s=rightDOM.editDescriptionUI(t),i=rightDOM.controlsAddEditTask();deleteChildNodes(e),e.append(r,a,s,i),addListeners.listenerSaveDescription(),addListeners.listenerCancelEditDescription()}function callback_cancelEditDescription(){const e=document.querySelector(".container-right"),t=document.querySelector(".title-panel-right"),r=t.innerHTML;deleteChildNodes(e);let a=get_selectedProject(r)[0];const s=rightDOM.projectDescriptionLabel(),i=rightDOM.displayDescription(a),n=rightDOM.taskMgeBtn();e.append(t,s,i,n),addListeners.listenerEditProjectDescription()}function callback_saveDescription(){const e=document.querySelector(".container-right");let t=document.querySelector(".title-panel-right");const r=t.innerHTML;let a=document.querySelector(".input-project-description").value,s=get_selectedProject(r)[0];s.describe=a,storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)),deleteChildNodes(e);const i=rightDOM.projectDescriptionLabel(),n=rightDOM.displayDescription(s),o=rightDOM.taskMgeBtn();e.append(t,i,n,o),addListeners.listenerEditProjectDescription(),addListeners.listenerManageTasks()}function callback_manageTasks(){const e=document.querySelector(".container-right");let t=document.querySelector(".title-panel-right"),r=get_selectedProject(t.innerHTML)[0];t=rightDOM.mainTitleRight(r),deleteChildNodes(e);const a=rightDOM.showAllTasks(r);e.append(t,a,rightDOM.taskAddBtn()),addListeners.listenerEditTask(),addListeners.listenerDeleteTasks(),addListeners.listenerAddTasks(),addListeners.listenerCheckbox(),radialBtnsMenu.enableRadianButtons()}function callback_checkbox(e){const t=e.target.checked,r=e.target.parentElement.children[1].firstChild.innerHTML,a=document.querySelector(".title-panel-right").innerText;let s;for(const e of projectList)if(e.name==a){s=e.tasks.map((e=>e[0])).indexOf(r);let a=e.tasks[s];a[5]=t,e.tasks[s]=a}storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList))}function callback_editTask(e){const t=e.target.parentElement.parentElement.childNodes[0].innerText,r=document.querySelector(".container-right"),a=document.querySelector(".title-panel-right"),s=a.innerHTML;let i;for(const e of projectList)if(e.name==s)for(let r=0;r<e.tasks.length;r++)e.tasks[r][0]==t&&(e.tasks[r][4]="x",i=e.tasks[r]);deleteChildNodes(r),r.append(a,rightDOM.makeInputForm(i),rightDOM.controlsAddEditTask()),addListeners.listenerSaveEditedTask(),addListeners.listenerCancelEditTasks(),radialBtnsMenu.disableRadianButtons()}function callback_deleteTasks(e){let t=e.target.parentNode.parentNode.firstChild.innerText;document.querySelector(".container-right");const r=document.querySelector(".title-panel-right").innerHTML;for(const e of projectList)if(e.name==r)for(let r=0;r<e.tasks.length;r++)e.tasks[r][0]==t&&e.tasks.splice(r,1);storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)),callback_manageTasks()}function callback_addTasks(){const e=document.querySelector(".container-right"),t=document.querySelector(".title-panel-right");deleteChildNodes(e),e.append(t,rightDOM.makeInputForm(),rightDOM.controlsAddEditTask()),addListeners.listenerSaveNewTask(),addListeners.listenerCancelEditTasks(),radialBtnsMenu.disableRadianButtons()}function callback_saveNewTask(){const e=document.querySelector(".input-task-name"),t=document.querySelector(".input-task-describe"),r=document.querySelector(".input-task-date"),a=document.querySelector(".input-task-priority"),s=document.querySelector(".title-panel-right").innerHTML;if(e.value.trim().length>0){for(let i of projectList)if(i.name==s){let s=[e.value,t.value,r.value,a.value,"OK"];""===r.value&&(s[2]="2099-12-31",alert("No date entered. Default 31/12/2099 was used")),i.tasks.push(s),storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList))}}else alert("New task needs to be assigned a name");callback_manageTasks()}function callback_saveEditedTask(){const e=document.querySelector(".input-task-name"),t=document.querySelector(".input-task-describe"),r=document.querySelector(".input-task-date"),a=document.querySelector(".input-task-priority");if(e.value.trim().length>0)for(let s of projectList)for(let i=0;i<s.tasks.length;i++){let n;"x"==s.tasks[i][4]&&(n=[e.value,t.value,r.value,a.value,"OK"],n[5]=s.tasks[i][5],s.tasks[i]=n,storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)))}else alert("New task needs to be assigned a name");callback_manageTasks()}function get_selectedProject(e){return projectList.filter((t=>t.name==e))}function _resetDatabase(){if(storageAvailable("localStorage")){window.localStorage.clear();const e=projectsOnLoad();localStorage.setItem("projectList",JSON.stringify(e))}}function deleteChildNodes(e){for(;e.firstChild;)e.removeChild(e.lastChild)}addListeners.listenerDatabase(),addListeners.listenerDeleteProject(),addListeners.listenerShowProjectDescription(),addListeners.listenerAddProject(),radialBtnsMenu.listenerRadialMenu();export{callback_showProjectDetails,callback_deleteProject,callback_addProject,callback_inputAddProject,callback_resetDatabase,callback_editProjectDescription,callback_cancelEditDescription,callback_saveDescription,callback_manageTasks,callback_checkbox,callback_editTask,callback_saveEditedTask,callback_deleteTasks,callback_addTasks,callback_saveNewTask};