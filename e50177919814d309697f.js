import"./style.css";import{storageAvailable,projectsOnLoad}from"./storage.js";import{projectDB}from"./projects.js";import{format,compareAsc}from"date-fns";import radialBtnsMenu from"./radialButtons.js";import leftDOM from"./left_panel.js";import rightDOM from"./right_panel.js";import addListeners from"./listeners.js";import iDelete from"./img/3643729_delete_trash_icon.svg";import iPencil from"./img/326602_edit_pencil_icon.svg";import iDatabase from"./img/185097_database_icon.svg";import iAdd from"./img/172525_plus_icon.svg";import iFlag0 from"./img/2561440_flag_icon_light.svg";import iFlag1 from"./img/2561440_flag_icon_medium.svg";import iFlag2 from"./img/2561440_flag_icon_dark.svg";const containerLHS=document.querySelector(".container-left");let projectList=projectsOnLoad();const leftPanelContent=leftDOM.onloadLeft(projectList);function callback_showProjectDetails(e){const t=document.querySelector(".container-right");deleteChildNodes(t);const r=e.target.innerText;let a;for(const e of projectList)e.name==r&&(a=e);const o=rightDOM.mainTitleRight(a),i=rightDOM.projectDescriptionLabel(),s=rightDOM.displayDescription(a),n=rightDOM.taskMgeBtn();rightDOM.taskAddBtn(),t.append(o,i,s,n),addListeners.listenerEditProjectDescription(),addListeners.listenerManageTasks()}function callback_deleteProject(e){const t=document.querySelector(".container-right"),r=document.querySelector(".container-left");deleteChildNodes(t),deleteChildNodes(r);let a=e.target.previousSibling.firstChild.data,o=0;for(const e of projectList)e.name==a&&projectList.splice(o,1),o=1;storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)),leftDOM.onloadLeft(projectList),addListeners.listenerDatabase(),addListeners.listenerDeleteProject()}function callback_addProject(){const e=document.querySelector(".container-right"),t=document.querySelector(".container-left");deleteChildNodes(e),deleteChildNodes(t),leftDOM.addProjectLoad(projectList),addListeners.listenerAddProject(),addListeners.listenerInputAddProject()}function callback_inputAddProject(e){if("Enter"===e.key){const e=document.querySelector(".input-box-add-project");let t=projectDB();t.name=e.value,t.describe="",projectList.push(t),console.log(projectList),storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)),deleteChildNodes(document.querySelector(".container-left")),leftDOM.onloadLeft(projectList),addListeners.listenerDatabase(),addListeners.listenerDeleteProject(),addListeners.listenerShowProjectDescription(),addListeners.listenerAddProject()}}function callback_resetDatabase(){const e=document.querySelector(".container-right"),t=document.querySelector(".container-left");deleteChildNodes(e),deleteChildNodes(t),_resetDatabase(),projectList=projectsOnLoad(),leftDOM.onloadLeft(projectList),addListeners.listenerDatabase(),addListeners.listenerDeleteProject(),addListeners.listenerShowProjectDescription()}function callback_editProjectDescription(){const e=document.querySelector(".container-right"),t=(document.querySelector(".container-left"),document.querySelector(".title-panel-right").innerHTML);let r;for(const e of projectList)e.name==t&&(r=e);const a=rightDOM.mainTitleRight(r),o=rightDOM.projectDescriptionLabel(),i=rightDOM.editDescriptionUI(),s=rightDOM.controlsAddEditTask();deleteChildNodes(e),e.append(a,o,i,s),addListeners.listenerSaveDescription(),addListeners.listenerCancelEditDescription()}function callback_cancelEditDescription(){const e=document.querySelector(".container-right"),t=document.querySelector(".title-panel-right"),r=t.innerHTML;let a;deleteChildNodes(e);for(const e of projectList)e.name==r&&(a=e);const o=rightDOM.projectDescriptionLabel(),i=rightDOM.displayDescription(a),s=rightDOM.taskMgeBtn();e.append(t,o,i,s),addListeners.listenerEditProjectDescription()}function callback_saveDescription(){const e=document.querySelector(".container-right");let t=document.querySelector(".title-panel-right");const r=t.innerHTML;let a,o=document.querySelector(".input-project-description").value;for(const e of projectList)e.name==r&&(e.describe=o,a=e);deleteChildNodes(e);const i=rightDOM.projectDescriptionLabel(),s=rightDOM.displayDescription(a),n=rightDOM.taskMgeBtn();e.append(t,i,s,n),addListeners.listenerEditProjectDescription(),addListeners.listenerManageTasks()}function callback_manageTasks(){const e=document.querySelector(".container-right");let t=document.querySelector(".title-panel-right");const r=t.innerHTML;let a;for(const e of projectList)e.name==r&&(a=e);t=rightDOM.mainTitleRight(a),deleteChildNodes(e);const o=rightDOM.showAllTasks(a);e.append(t,o,rightDOM.taskAddBtn()),addListeners.listenerEditTask(),addListeners.listenerDeleteTasks(),addListeners.listenerAddTasks(),addListeners.listenerCheckbox(),radialBtnsMenu.enableRadianButtons()}function callback_checkbox(e){console.log("test");const t=document.querySelector(".title-panel-right"),r=e.target.checked,a=e.target.parentElement.children[1].firstChild.innerHTML,o=t.innerText;let i;for(const e of projectList)if(e.name==o){i=e.tasks.map((e=>e[0])).indexOf(a);let t=e.tasks[i];t[5]=r,e.tasks[i]=t}console.log(projectList),storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList))}function callback_editTask(e){const t=e.target.parentElement.parentElement.childNodes[0].innerText,r=document.querySelector(".container-right"),a=document.querySelector(".title-panel-right"),o=a.innerHTML;let i;for(const e of projectList)if(e.name==o)for(let r=0;r<e.tasks.length;r++)e.tasks[r][0]==t&&(e.tasks[r][4]="x",i=e.tasks[r]);deleteChildNodes(r),r.append(a,rightDOM.makeInputForm(i),rightDOM.controlsAddEditTask()),addListeners.listenerSaveEditedTask(),addListeners.listenerCancelEditTasks(),radialBtnsMenu.disableRadianButtons()}function callback_deleteTasks(e){let t=e.target.parentNode.parentNode.firstChild.innerText;document.querySelector(".container-right");const r=document.querySelector(".title-panel-right").innerHTML;for(const e of projectList)if(e.name==r)for(let r=0;r<e.tasks.length;r++)e.tasks[r][0]==t&&e.tasks.splice(r,1);storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)),callback_manageTasks()}function callback_addTasks(){const e=document.querySelector(".container-right"),t=document.querySelector(".title-panel-right");deleteChildNodes(e),e.append(t,rightDOM.makeInputForm(),rightDOM.controlsAddEditTask()),addListeners.listenerSaveNewTask(),addListeners.listenerCancelEditTasks(),radialBtnsMenu.disableRadianButtons()}function callback_saveNewTask(){const e=document.querySelector(".input-task-name"),t=document.querySelector(".input-task-describe"),r=document.querySelector(".input-task-date"),a=document.querySelector(".input-task-priority"),o=document.querySelector(".title-panel-right").innerHTML;if(e.value.trim().length>0){for(let i of projectList)if(i.name==o){let o;o=[e.value,t.value,r.value,a.value,"OK"],""===r.value&&(o[2]="2099-12-31",alert("No date entered. Default 31/12/2099 was used")),i.tasks.push(o),console.log(i.tasks),storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList))}}else alert("New task needs to be assigned a name");callback_manageTasks()}function callback_saveEditedTask(){const e=document.querySelector(".input-task-name"),t=document.querySelector(".input-task-describe"),r=document.querySelector(".input-task-date"),a=document.querySelector(".input-task-priority");if(console.log(a.value),e.value.trim().length>0)for(let o of projectList)for(let i=0;i<o.tasks.length;i++){let s;"x"==o.tasks[i][4]&&(s=[e.value,t.value,r.value,a.value,"OK"],s[5]=o.tasks[i][5],o.tasks[i]=s,storageAvailable("localStorage")&&localStorage.setItem("projectList",JSON.stringify(projectList)))}else alert("New task needs to be assigned a name");console.log(projectList),callback_manageTasks()}function _resetDatabase(){if(storageAvailable("localStorage")){window.localStorage.clear();const e=projectsOnLoad();localStorage.setItem("projectList",JSON.stringify(e))}}function deleteChildNodes(e){for(;e.firstChild;)e.removeChild(e.lastChild)}addListeners.listenerDatabase(),addListeners.listenerDeleteProject(),addListeners.listenerShowProjectDescription(),addListeners.listenerAddProject(),radialBtnsMenu.listenerRadialMenu();export{callback_showProjectDetails,callback_deleteProject,callback_addProject,callback_inputAddProject,callback_resetDatabase,callback_editProjectDescription,callback_cancelEditDescription,callback_saveDescription,callback_manageTasks,callback_checkbox,callback_editTask,callback_saveEditedTask,callback_deleteTasks,callback_addTasks,callback_saveNewTask};